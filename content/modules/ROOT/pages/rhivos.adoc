= Build RHIVOS image with Automotive Image Builder
:sectnums:

In this module we will learn how to build and customize RHIVOS images with *Automotive Image Builder*, a tool to create various kinds of OS images based on RHEL/CentOS derived distributions with an automotive focus. The basic operation it does is "composing" yaml-based manifests into an osbuild json file. This json file is a precise build instruction for how to build an image with osbuild with the very specific software that was chosen during the compose. For example, additional applications to install into the image.

== Manifests

The source repo is already populated with some Automotive Image Builder manifests. From the file explorer of the Dev Space, open `manifests/simple.aib.yml`, which is an example showing how to build a minimal RHIVOS image with additional rpm packages and root password preset. Another noteworthy file is `.aib-ci.yml`, which specifies the base image to use, target architecture and hardware platform, and other parameters to be passed to `automotive-image-builder`.

image::18-vscode.png[]

IMPORTANT: placeholder image

== Build RHIVOS image manually

Automotive image builder does not support cross-compilation, to build images for other architectures (like aarch64), we must run it on the respective systems. An aarch64 based virtual machine is provisioned as part of the lab to serve as our builder host. A helper script is provided to execute the build on it, in the Dev Space terminal, run:

[,console]
----
$ aib-build qemu-simple simple.qcow2
----

NOTE: We are using the `qemu-simple` preset in `.aib-ci.yaml` to build an image with the manifest `manifests/simple.aib.yaml` and targeting the qemu platform, which is the emulator for our virtualized hardware platform, and store the resulting image as `simple.qcow2`

== Build RHIVOS image automatically

When we push our changes to the code repository in the last module, another *Red Hat OpenShift Pipelines* task was also triggered to automatically build an RHIVOS image with the `qemu-application` preset in `.aib-ci.yaml`. This preset uses the manifest `manifests/application.aib.yaml`, which in additional to what's in `manifests/simple.aib.yaml`, also installs our application into the image.

To check the progress of the build, see {os_build_pipeline}

== Next Steps

Now we have our RHIVOS image ready, traditionally we would require physical access to the target platform to test it, which involves flashing sdcards or other storage mediums with the image, connecting various cables to a developer workstation, and many other manual steps. But with *Jumpstarter*, it abstracts the physical access away with an easy to use software interface, allowing you to interact with your hardware and test your application locally, remotely, or automatically with a unified experience. In the next module we will learn the basics of *Jumpstarter*, including how to configure *Jumpstarter* for local development and the *Jumpstarter* command line interface.
